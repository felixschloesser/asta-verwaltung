{% extends "keys/base.html" %}

{% block additional_css %}
    {% load static %}
    <link href="{% static 'fontawesome_free/css/all.min.css' %}" rel="stylesheet" type="text/css">
{% endblock %}


{% block title %}Dashboard | Schlüsselsystem{% endblock %}

{% block navbar_items %}
    <a class="navbar-item" href="{% url 'keys:person-list' %}">Personen</a>
    <a class="navbar-item" href="{% url 'keys:room-list' %}">Räume</a>
    <a class="navbar-item" href="{% url 'keys:key-list' %}">Schlüssel</a>
    <a class="navbar-item" href="{% url 'keys:issue-list' %}">Ausleihen</a>
{% endblock %}


{% block content %}
	<div class="container is-max-desktop">
		{% if messages %}
	        {% for message in messages %}
		        <article class="message is-{{ message.tags }} mb-4">
		            <div class="message-body">
		                {{ message }}
		            </div>
		        </article>
	        {% endfor %}
	    {% endif %}
	</div>

	{% if user.is_authenticated %}
		<div class="container is-max-desktop">
			<div class="block">
			    <h1 class="title is-2">Dashboard</h1>
			    <p class="text">Wilkommen, {{ user.first_name }}! Das hier ist unser neues Schlüsselsystem. Toll oder?</p>
			</div>

			<div class="container is-max-widescreen py-5">
		   		<div class="grid-container mb-6">

					<div class="box issues has-background-light">
						<div class="content">
					        <h2 class="title mb-4">Ausleihen</h2>
					        {% if issues %}
						        <table class="table is-hoverable has-background-light">
							        <thead>
					                    <th>Schlüssel</th>
					                        <th>Person</th>
					                    </thead>
					                <tbody>
					                    {% for issue in issues %}
					                        <tr data-href={{ issue.get_absolute_url }} tabindex="0">
					                            <td>
					                                <a class="subtitle is-6" href={{ issue.get_absolute_url }} tabindex="-1">{{ issue.key }}</a>
					                            </td>
					                            <td>
					                                {{ issue.person }}
					                            </td>
					                        </tr>
					                    {% endfor %}
					                </tbody>
						        </table>
						    {% else %}
						        <p>Keine aktiven Ausleihen.</p>
						    {% endif %}
					    </div>
					</div>
					<div class="box content shortcuts-container">
						<h2 class="title mb-4">Kurzbefehle</h2>
					    <div class="asta">
					    	<div class="level is-mobile">
					    		<div class="level-right">
						    		<div class="level-item">
						    			<h3 class="subtitle is-4">AStA:</h3>
						    		</div>
						    	</div>
						    	<div class="level-left">
							    	<div class="level-item">
									 	<a href="{% url 'keys:room-search-results' %}?group=AStA">
									 		<span class="tag is-medium is-light">Räume</span>
									 	</a>&nbsp;
									 	<a href="{% url 'keys:person-search-results' %}?group=AStA">
									 		<span class="tag is-medium is-dark">Personen</span>
									 	</a>
							    	</div>
							    </div>
						    </div>
					    </div>
					    <div class="fsr">
					 		<div class="level is-mobile">
					 			<div class="level-left">
						    		<div class="level-item">
						    			<h3 class="subtitle is-4">FSRe:</h3>
						    		</div>
						    	</div>
						    	<div class="level-right">
							    	<div class="level-item">
									 	<a href="{% url 'keys:room-search-results' %}?group=FSR">
									 		<span class="tag is-medium is-light">Räume</span>
									 	</a>&nbsp;
									 	<a href="{% url 'keys:person-search-results' %}?group=FSR">
									 		<span class="tag is-medium is-dark">Personen</span>
									 	</a>
							    	</div>
							    </div>
						    </div>
					    </div>
					    <div class="ag">
					    	<div class="level is-mobile">
					    		<div class="level-left">
						    		<div class="level-item">
						    			<h3 class="subtitle is-4">AGs:</h3>
						    		</div>
						    	</div>
						    	<div class="level-right">
						    		<div class="level-item">
									 	<a href="{% url 'keys:room-search-results' %}?group=AG">
									 		<span class="tag is-medium is-light">Räume</span>
									 	</a>&nbsp;
									 	<a href="{% url 'keys:person-search-results' %}?group=AG">
									 		<span class="tag is-medium is-dark">Personen</span>
									 	</a>
									</div>
						    	</div>
						    </div>
						</div>

						<a href={% url 'keys:person-add' %} class="button is-primary is-fullwidth mt-4">
						    <span class="icon">
						     	<i class="fas fa-user-plus"></i>
						    </span>
						    <span>Neue Person</span>
						 </a>
				  	</div>

			 		<div class="box content person-search has-background-primary">
			 			<h2 class="title is-4 has-text-light">Personensuche</h2>
		  				<form action={% url 'keys:person-search-results' %} method='get'>
		  					<div class="field has-addons">
		                    	<div class="control is-expanded">
		                            <input class="input is-fullwidth" aria-label="Personensuche" name='q' type="text" placeholder="Vor-/Nachname/Gruppe" required>
		                    	</div>
		                    	<div class="control">
			                        <button type='submit' class="button is-info">Suchen</button>
		                		</div>
							</div>
						</form>
				 	</div>

					<div class="box content key-search has-background-light">
			 			<h2 class="title is-4">Schlüsselsuche</h2>
						<form action={% url 'keys:key-search-results' %} method='get'>
		  					<div class="field has-addons">
		                    	<div class="control is-expanded">
		                            <input class="input is-fullwidth" aria-label="Schlüsselsuche" name='q' type="text" placeholder="Schlüsselnr./Modell" required>
		                    	</div>
		                    	<div class="control">
			                        <button type='submit' class="button is-info">Suchen</button>
		                		</div>
							</div>
						</form>
					</div>

				 	<div class="box content statistics">
				 		<h2 class="title mb-4">Statistiken</h2>
			        	<div class="columns">
			        		<div class="column key">
				        		<div class="content is-small">
				          			<p class="title is-6 mb-2">Schlüssel</p>
			          				<p>
			          					Gesamtzahl: {{ keys.count }}<br>
			          					Ausgeliehen: {{ keys.currently_issued.count }}&nbsp;({{ keys.currently_issued_percent }}%)<br>
			          					Verloren: {{ keys.stolen_or_lost.count }}&nbsp;({{ keys.stolen_or_lost_percent }}%)<br>
				          			</p>
				          		</div>
				          	</div>


							<hr class="person">
							<div class="person divider is-vertical is-right"></div>
			        		<div class="column person">
				        		<div class="content is-small">
				          			<p class="title is-6 mb-2">Personen</p>
				          			<p>
				          				Gesamtzahl: {{ people.count }}<br>
				          				Kaution&nbsp;bezahlt: {{ people.paid_deposit.count }}&nbsp;({{ people.paid_deposit_percent }}%)<br>
				          				Mit Ausleihen: {{ people.active_issues.count }}&nbsp;({{ people.active_issues_percent }}%)<br>
				          			</p>
				          		</div>
				          	</div>

							<hr class="room">
							<div class="room divider is-vertical is-right"></div>

			        		<div class="column room">
				        		<div class="content is-small">
				        			<p class="title is-6 mb-2">Räume</p>
				          			<p>
				          				Gesamtzahl: {{ rooms.all.count }}<br>
				          				AStA: {{ rooms.of_asta.count }}&nbsp;({{ rooms.of_asta_percent }}%)<br>
				          				FSRe: {{ rooms.of_fsr.count }}&nbsp;({{ rooms.of_fsr_percent }}%)
				          			</p>
				          		</div>
			        		</div>
			        	</div>
			 		</div>
				</div>
			</div>
		</div>
	{% else %}
		<div class="container is-max-desktop content">
		    <h1 class="title is-2">Wilkommen!</h1>
		    <p class="content">Das hier ist das neue Schlüsselsystem des AStAs.</p>

		    <div class="box has-background-light mt-6">
			    <h2 class="subtitle">Anmeldung mit RZ&#8209;Kennung</h2>
			    <p>
	                Im nächsten Schritt werden Sie zur Gitlab-Instanz der TU-Hamburg weitergeleitet. Dort melden sie sich mit Ihrer Rechenzentrums-Kennung an.
	                Beim ersten Mal werden Sie aufgefordert werden diese Anwendung zu Authorisieren.
	            </p>
	            <p>
	                Nach erfolgreicher Anmeldung werden Sie auf dieser Seite zurückgeleitet.
	            </p>
	            <div class="buttons is-right">
	                <a class="button is-medium is-primary" href={% url 'oidc_authentication_init' %}>
	                    <span class="icon">
	                        <i class="fab fa-gitlab fa-lg"></i>
	                    </span>
	                    <span>
	                        Anmelden
	                    </span>
	                </a>
	            </div>
	        </div>
		</div>
	{% endif %}

</div>

{% endblock %}
